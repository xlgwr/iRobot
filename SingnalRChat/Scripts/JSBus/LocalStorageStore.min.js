var JSBus;(function(n){var t=function(){function t(){this.containerName="default"}return t.prototype.initQueues=function(){this._outgoing||(this._outgoing=new n.LocalStorageQueue(this.containerName+".outgoing"),this._sent=new n.LocalStorageQueue(this.containerName+".sent"),this._retry=new n.LocalStorageQueue(this.containerName+".retry"),setInterval(this.moveBackToOutgoing.bind(this,this.retry,3e4),1e4),setInterval(this.moveBackToOutgoing.bind(this,this.sent,6e4),1e4))},Object.defineProperty(t.prototype,"outgoing",{get:function(){return this.initQueues(),this._outgoing},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sent",{get:function(){return this.initQueues(),this._sent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"retry",{get:function(){return this.initQueues(),this._retry},enumerable:!0,configurable:!0}),t.prototype.add=function(n){this.outgoing.add(n.id.toString(),n)},t.prototype.ack=function(n){this.sent.remove(n)},t.prototype.sendAll=function(n){var t=this,i=this.outgoing.all();i.forEach(function(i){n(i).then(t.markSent,function(n){console.log("Error sending message, delaying:",i,n);t.delay(i.id)})})},t.prototype.markSent=function(n){this.moveMessageFromOutgoingTo(this.sent,n)},t.prototype.delay=function(n){this.moveMessageFromOutgoingTo(this.retry,n)},t.prototype.moveMessageFromOutgoingTo=function(n,t){var i=this.outgoing.remove(t);i&&n.add(i.id,i,new Date)},t.prototype.moveBackToOutgoing=function(n,t){for(var r=n.removeWhereLastOperationOlderThan(t),i=r.length-1;i>=0;i--)console.log("Moving message %s %s --> %s",r[i].id,n.name,this.outgoing.name),this.outgoing.add(r[i].id,r[i])},t}();n.LocalStorageStore=t})(JSBus||(JSBus={}));
//# sourceMappingURL=LocalStorageStore.min.js.map